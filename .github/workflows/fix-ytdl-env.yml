name: Fix ytdl Environment Variables

on:
  workflow_dispatch:

jobs:
  fix-env:
    name: Update ytdl Environment
    runs-on: ubuntu-latest
    
    steps:
      - name: Fix environment variables on EC2
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.EC2_HOST }}
          username: ec2-user
          key: ${{ secrets.EC2_SSH_KEY }}
          script: |
            cd /home/ec2-user/ytdl
            
            echo "Current .env file:"
            cat .env
            echo ""
            echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
            
            echo "Checking if keys match..."
            echo "Expected key (first 20 chars): b9ed97215fc43a2da861"
            echo "Actual key in .env (first 20 chars):"
            grep YTDL_INTERNAL_API_KEY .env | cut -d'=' -f2 | cut -c1-20
            
            echo ""
            echo "Container environment:"
            docker exec ytdl printenv | grep YTDL_INTERNAL_API_KEY || echo "YTDL_INTERNAL_API_KEY not set in container!"
